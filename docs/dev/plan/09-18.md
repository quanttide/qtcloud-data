# 批量生成剩余任务文件（09-18）

## 阶段二：测试重构（P0）

### TASK_009: 重构测试结构

```python
# 文件：tests/fixtures/__init__.py
"""业务层测试包

本包包含从业务视角编写的测试，使用 quanttide_data_toolkit。
"""

# 文件：tests/fixtures/business/__init__.py
"""业务层测试包"""

# 文件：tests/fixtures/technical/__init__.py
"""技术层测试包"""
```

### TASK_010: 重写 Workspace 测试

```python
"""工作区完整性测试"""
import pytest
from pathlib import Path
from quanttide_data_toolkit import Workspace

FIXTURES_ROOT = Path(__file__).parent.parent / "fixtures" / "workspace"

class TestWorkspace:
    """工作区完整性验证"""

    @pytest.fixture
    def workspace(self):
        return Workspace(FIXTURES_ROOT)

    def test_workspace_complete(self, workspace):
        """工作区包含所有必需组件"""
        assert workspace.is_complete(), workspace.validation_report()
```

### TASK_011: 重写 BusinessArtifacts 测试

```python
"""业务工件测试"""
import pytest
from pathlib import Path
from quanttide_data_toolkit import Workspace, BusinessArtifacts

FIXTURES_ROOT = Path(__file__).parent.parent / "fixtures" / "workspace"

class TestBusinessArtifacts:
    """业务工件验证"""

    @pytest.fixture
    def workspace(self):
        return Workspace(FIXTURES_ROOT)

    @pytest.fixture
    def artifacts(self, workspace):
        return BusinessArtifacts(workspace)

    def test_plan_clear(self, artifacts):
        """Plan 清晰度"""
        assert artifacts.plan_is_clear()

    def test_schema_complete(self, artifacts):
        """Schema 完整性"""
        assert artifacts.schema_is_complete()
```

### TASK_012: 重写 DataPipeline 测试

```python
"""数据流水线测试"""
import pytest
from pathlib import Path
from quanttide_data_toolkit import Workspace, DataPipeline

FIXTURES_ROOT = Path(__file__).parent.parent / "fixtures" / "workspace"

class TestDataPipeline:
    """数据流水线验证"""

    @pytest.fixture
    def workspace(self):
        return Workspace(FIXTURES_ROOT)

    @pytest.fixture
    def pipeline(self, workspace):
        return DataPipeline(workspace)

    def test_inspector_available(self, pipeline):
        """Inspector 可用性"""
        assert pipeline.inspector_available()
```

### TASK_013: 重写 DataSchema 和 Report 测试

```python
"""数据结构测试"""
import pytest
from pathlib import Path
import pandas as pd
from quanttide_data_toolkit import Workspace, DataSchema

FIXTURES_ROOT = Path(__file__).parent.parent / "fixtures" / "workspace"

class TestDataSchema:
    """数据结构验证"""

    @pytest.fixture
    def schema_path(self):
        return FIXTURES_ROOT / "schema" / "questionnaire_schema.json"

    @pytest.fixture
    def schema(self, schema_path):
        return DataSchema(schema_path)

    def test_schema_complete(self, schema):
        """Schema 完整性"""
        assert schema.is_complete()
```

## 阶段三：术语对齐与文档完善（P1）

### TASK_014: 创建业务术语词典

```markdown
# 业务术语词典

## 术语对照表

| 技术术语 | 业务术语 | 说明 |
|---------|---------|------|
| exists | complete / available | "exists" 是技术概念 |
| is_valid_json | well_formed | "well formed" 表达格式正确性 |
```

### TASK_015: 替换技术术语

```bash
# 批量替换测试方法名
sed -i '' 's/test_workspace_exists/test_workspace_complete/g' tests/fixtures/business/*.py
sed -i '' 's/test_plan_exists/test_plan_clear/g' tests/fixtures/business/*.py
```

### TASK_016: 完善文档

```python
"""业务层测试包

本包包含从业务视角编写的测试，使用 quanttide_data_toolkit。

设计原则：
- 优先使用业务术语
- 使用领域模型封装技术细节
- 测试方法名直接表达业务意图
"""
```

## 阶段四：验证与优化（P1）

### TASK_017: QA 重新审计

```bash
# 运行测试
pytest tests/fixtures/business/ -v

# QA 审计
python -m qa.audit tests/fixtures/business/
```

### TASK_018: 业务人员评审

```markdown
# 业务评审反馈

## 评审时间
日期: ?
参与人: ?

## 可读性评估
- TestWorkspace: ?
- TestBusinessArtifacts: ?
- TestDataPipeline: ?
```
